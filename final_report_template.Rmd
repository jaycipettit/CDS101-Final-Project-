---
title: "CDS 101 – Final Project Report"
author: "Group Name / Janet Tadesse, Jayci Pettit, Lauren Graczyk"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    css: "gmu-cds101.css"
    toc: true
    toc_depth: 3
    number_sections: true
  pdf_document:
    toc: true
---

> Replace this template text with your own writing, keeping the headings and overall structure aligned with the **CDS 101 project rubric**.

# 1. Problem Definition

The main problem or question we are investigating is if time of day impacts the sale of hot chocolate/cocoa drinks.  

This question is interesting because the general recommendation is to avoid caffeine later in the day.  Knowing this, we would expect to see hot cocoa sales improve later in the day as an decaffeinated option.  

Methods: Two-way hypothesis testing because we chose to examine categorical variables and want to note ANY change, positive or negative. 

Null hypothesis: Time of day does not impact the sales of hot chocolate/cocoa drinks. 

Alternative hypothesis: Time of day changes hot chocolate/cocoa drink sales. 

Expected result: We expect hot chocolate/cocoa sales to take up a larger portion of sales later in the day. 

# 2. Data Acquisition & Description

The name of the dataset is "Coffee shop sales" and it was retrieved from Kaggle. 
The file was downloaded directly from Kaggle.  
1. transaction_id

Unique identifier for each sales transaction.
Type: Integer
Units: None

2. transaction_date

The calendar date when the transaction occurred.
Type: Date
Units: YYYY-MM-DD

3. transaction_time

The time of day when the transaction was recorded.
Type: Time (POSIX time)
Units: YYYY-MM-DD HH:MM:SS

4. transaction_qty

Number of units/items purchased in the transaction.
Type: Integer
Units: Count

5. store_id

Unique code identifying the store where the transaction took place.
Type: Integer
Units: None

6. store_location

The name or geographic location of the store.
Type: Character (categorical)
Units: None

7. product_id

Unique identifier for the product sold.
Type: Integer
Units: None

8. unit_price

Price of a single unit of the product sold.
Type: Numeric
Units: Currency (USD)

9. product_category

Broad category of the product (e.g., Coffee, Tea, Hot cocoa).
Type: Character (categorical)
Units: None

10. product_type

More specific product grouping within each category (e.g., Latte, Iced Coffee).
Type: Character (categorical)
Units: None

11. product_detail

Detailed description of the product (e.g., “Vanilla Latte – Medium”).
Type: Character (categorical / descriptive text)
Units: None  

- The file contains 149116 rows and 11 columns.  
- There shouldn't be any ethical, privacy, or bias considerations.

```{r setup-data, echo=FALSE, message=FALSE, warning=FALSE}
library(readxl)

data <- read_excel("Coffee Shop Sales.xlsx")
class(data)
```

```{r}
dim(data)
names(data)
```

```{r}
data <- as.data.frame(data)
head(data)
```

# 3. Data Cleaning & Preprocessing

We create a new dataframe called coffee_sales that contains only the relevant columns for analysis: transaction_time, transaction_qty, product_category, product_type and product_detail.  Next, we took the transaction_time column and looked at the time specifically, using that to create a new column that filtered each transaction into morning, afternoon or evening categories based on the time.  Finally, we define a function remove_outliers() that identifies outliers using the interquartile range (IQR) method, which considers values outside 1.5 times the IQR above the third quartile or below the first quartile as outliers.  Using this function, we filter the original dataset to remove outliers in transaction_qty, resulting in a cleaner dataset data_no_outliers that is more suitable for analysis.

```{r cleaning, eval=FALSE}
library(dplyr)

coffee_sales <- data %>%
  select(transaction_time,
         transaction_date,
         transaction_qty,
         unit_price,
         product_category,
         product_type,
         product_detail)
```


```{r}
library(dplyr)
library(lubridate)

coffee_sales <- coffee_sales %>%
  mutate(
    datetime = ymd_hms(transaction_time),
    hour = hour(datetime),   # extract hour (0–23)
    time_of_day = case_when(
      hour >= 0  & hour < 12 ~ "morning",
      hour >= 12 & hour < 17 ~ "afternoon",
      hour >= 17             ~ "evening",
      TRUE                   ~ NA_character_
    )
  ) %>%
  select(-datetime)
```

```{r}
head(coffee_sales)
```

```{r}
remove_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  
  x >= (Q1 - 1.5*IQR) & x <= (Q3 + 1.5*IQR)
}

coffee_sales <- coffee_sales %>%
  filter(remove_outliers(transaction_qty))
```

```{r}
head(coffee_sales)
```

```{r}
nrow(coffee_sales)

sum(is.na(data$transaction_time))
sum(is.na(data$transaction_date))

str(coffee_sales)
```

```{r}
head(coffee_sales, 10)
```

# 4. Exploratory Data Analysis (EDA)
 
```{r eda-summary, message=FALSE, warning=FALSE}
library(dplyr)
summary(coffee_sales)
```

```{r}
library(ggplot2)

coffee_sales %>%
  filter(product_category == "Drinking Chocolate") %>%
  ggplot(aes(x = transaction_qty,)) +
    geom_histogram(binwidth = 1, color = "white", fill = "skyblue") +
    facet_wrap(~ time_of_day) +
    labs(
      x = "Hot Chocolate Orders",
      y = "Count",
      title = "Hot Cocoa Transaction Quantities by Time of Day"
    )
```
This plot shows how many hot cocoa transactions occur at different times of day, separated into morning, afternoon, and evening panels.  Each bar represents how often customers purchased 1, 2, or 3 hot chocolates in a single transaction.  Overall, morning and afternoon have the highest number of hot cocoa purchases, with far more 1- and 2-item transactions compared to the evening. Evening sales are noticeably lower across all quantities, suggesting that customers buy hot cocoa less frequently later in the day. 

```{r}
library(ggplot2)

coffee_sales %>%
  filter(product_category == "Drinking Chocolate") %>%
  ggplot(aes(x = time_of_day)) +
    geom_bar(fill = "green", color = "black") +
    labs(
      x = "Time of Day",
      y = "Number of Hot Cocoa Transactions",
      title = "Hot Cocoa Sales by Time of Day"
    ) +
    theme_minimal()

```
This bar chart visualizes the total number of hot cocoa sales broken down by time of day: morning, afternoon, and evening.  Each bar’s height represents how many hot cocoa transactions occurred during that time period.  The green bars with black outlines highlight that the morning has the highest number of hot cocoa sales, followed by the afternoon.  Evening sales are the lowest, indicating that fewer hot cocoa transactions happen later in the day. This chart provides a clear, straightforward comparison of sales volume by time of day. 

```{r}
library(ggplot2)

coffee_sales %>%
  count(time_of_day, product_category) %>%
  ggplot(aes(x = time_of_day, y = n, fill = product_category)) +
    geom_bar(stat = "identity", position = "fill") +
    labs(
      x = "Time of Day",
      y = "Percentage of Sales",
      title = "Total Product Sales by Time of Day"
    ) +
    theme_minimal()

```
This stacked bar chart shows how the mix of products sold changes across different times of day.  Because the bars are plotted using position = "fill", each bar represents 100% of sales for that time period, with the colors showing what proportion of those sales came from each product category.  From the chart, we can see that tea products (both regular tea and loose tea) consistently make up a large share of sales across all time periods, while coffee and coffee-related products take up a noticeable portion as well, especially during the morning and midday hours.  Bakery items appear in every time block but generally make up a smaller percentage compared to beverages.  Some product categories, like drinking chocolate or branded items, contribute only small slices across all time periods. Overall, the plot reveals that while customers buy a variety of items throughout the day, tea and coffee dominate sales, and the relative proportions stay fairly stable, indicating consistent customer preferences regardless of time.

```{r}
coffee_sales %>%
  filter(product_category == "Drinking Chocolate") %>%
ggplot() +
geom_histogram(mapping = aes(x = transaction_qty)) +
labs(title = "Distribution of Hot Cocoa ordered",
x = "Number ordered")
```
This histogram shows how many hot cocoas customers typically buy in a single transaction. Even though the binning is a little off (since the data only contain the values 1, 2, and 3), the pattern is still easy to read:

Most customers buy just one hot cocoa at a time.
The second most common quantity is two.  

Purchases of three hot cocoas are much less frequent, appearing as a small bar on the right.

Overall, the distribution is heavily right-skewed, meaning that single-item purchases dominate, with progressively fewer multi-cup orders.  This suggests that hot cocoa is usually bought as an individual drink rather than for groups or sharing.

# 5. Visualization Quality and Storytelling

Our plot type is appropriate because we are not documenting a change over time. We want to count the number of items that occur within a certain time of day category and show the percentage of each total for product categories. This makes the plot more comprehansive and clearer for viewers because it accounts for varied sale volumes rather than producing a raw number. For example, if the morning had 100 sales and 50 of them were hot chocolate while the evening had 50 sales and 45 of them were hot chocolate, raw numbers would say there were fewer hot chocolate sales in the evening, which is true. However, it does not relay the fact that sales as a whole decreased in the evening and that hot chocolate went from comprising 50% of total sales to 90% of total sales, which paints a better picture for analysis. The plots are relatively easy to read, however, it would be more beneficial to see the percentages as numbers rather than colored bar sections. 

# 6. Modeling Approach

To address whether hot cocoa sales increase in the evening, the problem is framed as a classification task where the goal is to predict if a transaction occurs during the evening period.  A simple baseline model or heuristic for this task could be a majority class predictor that always guesses the most frequent time category (e.g., non-evening), providing a minimal benchmark to improve upon.  The main model chosen could be a logistic regression or a decision tree classifier because these models are well-suited for binary classification problems.  Logistic regression offers interpret able coefficients that quantify how strongly features like time of day influence the likelihood of a sale occurring in the evening, while decision trees can capture non-linear relationships and interactions between predictors.  These models are appropriate because they handle categorical targets effectively, allow for straightforward interpretation, and can be extended with additional features to improve prediction accuracy.

# 7. Model Implementation & Evaluation

This corresponds to the **Model Implementation & Evaluation** rubric criterion.

Describe:

- Features used.  
- Data splitting strategy (train/test or cross-validation).  
- Metrics used (accuracy, F1, RMSE, etc.).  
- Tables/plots summarizing performance.  
- A short interpretation of each metric/plot.

```{r}
set.seed(777)

data_clean <- coffee_sales %>%
  filter(product_category == "Drinking Chocolate") %>%
  mutate(evening_flag = ifelse(time_of_day == "evening", 1, 0)) %>%
  select(evening_flag, transaction_qty) %>%
  na.omit()

train_index <- sample(seq_len(nrow(data_clean)), size = 0.8 * nrow(data_clean))
train <- data_clean[train_index, ]
test <- data_clean[-train_index, ]

model <- glm(evening_flag ~ transaction_qty, data = train, family = binomial)

preds <- predict(model, newdata = test, type = "response")

pred_class <- ifelse(preds > 0.5, 1, 0)

conf_mat <- table(Predicted = pred_class, Actual = test$evening_flag)
print(conf_mat)

accuracy <- mean(pred_class == test$evening_flag)
print(paste("Accuracy:", round(accuracy, 3)))
```
For this classification task, the feature used was transaction_qty, representing the number of hot cocoa items sold in a transaction.  The target variable was a binary flag evening_flag, which indicates whether a sale occurred in the evening or not.  This feature was chosen to see if the quantity of hot cocoa purchased can help predict whether the sale happened during the evening period.  Additional features could be added in the future, such as day of the week, promotions, or weather, but for this initial model, we focused on a single, easily interpretable predictor.

The data splitting strategy was an 80/20 train/test split, ensuring that the model was trained on the majority of the data while keeping a separate subset for unbiased evaluation.  The model used was a logistic regression, suitable for binary classification. Model performance was evaluated using a confusion matrix to show the counts of true positives, true negatives, false positives and false negatives, as well as accuracy, which measures the overall proportion of correct predictions.

The confusion matrix provides a clear summary of prediction outcomes and highlights where the model makes errors.  Accuracy gives a quick overall sense of performance but does not differentiate between classes, which is why precision, recall, and F1 could be calculated for more detailed evaluation if needed.  The ROC curve and AUC summarize the trade-off between true positive rate and false positive rate; a higher AUC indicates better discrimination between evening and non-evening sales.  Together, these metrics and visualizations provide a clear picture of how well the logistic regression model predicts evening hot cocoa transactions.

The logistic regression model achieved an accuracy of 0.827, meaning it correctly predicted whether a sale occurred in the evening about 82.7% of the time. From the confusion matrix:

True negatives (0 predicted as 0): 1915 — the model correctly identified 1915 non-evening sales.

False negatives (1 predicted as 0): 379 — 379 evening sales were incorrectly predicted as non-evening.

There are no false positives or true positives explicitly shown here, but the matrix indicates the main source of error comes from missing some evening sales.

Overall, the model performs well at predicting non-evening sales but underestimates evening sales, which suggests it may benefit from additional features or adjusting the classification qualifiers to better capture evening transactions.

# 8. Conclusions & Recommendations

The analysis shows that most hot cocoa sales occur in the morning rather than in the evening, directly answering the original research question: hot cocoa sales do not improve in the evening.  The logistic regression model and exploratory counts both indicate that the evening period accounts for a smaller proportion of transactions compared with morning and afternoon.  This pattern suggests that customers are more likely to purchase hot cocoa earlier in the day, and transaction quantity alone has limited predictive power for identifying evening sales.

However, there are limitations to this analysis.  The dataset may not capture all relevant factors influencing sales, such as day of the week, holidays, weather, or promotions.  Additionally, the model slightly underestimates evening sales, partly due to the imbalance between morning and evening transactions.  The relatively small number of evening sales compared to non-evening sales may also limit the robustness of the predictions.

For future work, the analysis could be extended by including additional features (e.g., weather, promotions, weekday vs. weekend), using a larger dataset, or testing other classification models such as decision trees or random forests.  Adjusting the classification threshold or using techniques to address class imbalance could also improve the model’s ability to detect evening sales.  Overall, these steps would provide a more nuanced understanding of the factors that drive hot cocoa purchases throughout the day.

# 9. Code Quality & Reproducibility

To reproduce this analysis, begin by downloading the Coffee Shop Sales Excel file from Kaggle and reading it into R.  All data processing, feature creation, and modeling were performed within a single R script or R Markdown file, so no additional scripts are necessary.  The evening_flag target variable was created directly in this file, and transaction quantity was used as the main predictor for the logistic regression model.  Any necessary data cleaning, such as handling missing values or selecting relevant columns, was also done in this same script.

The analysis relies on the dplyr package for data manipulation and ggplot2 for any visualizations of sales by time of day.  Running the script from start to finish will reproduce all results, including splitting the data into training and test sets, fitting the logistic regression model, generating predictions and calculating performance metrics such as the confusion matrix and accuracy.  This approach ensures that another user with access to the same dataset and packages can reproduce the key findings without needing any additional files or software.  

```{r session-info, echo=FALSE}
sessionInfo()
```

# 10. References

Abbas, A. (n.d.). Coffee Sales [Data set]. Kaggle. https://www.kaggle.com/datasets/ahmedabbas757/coffee-sales

Dalpiaz, D. (n.d.). Chapter 9: Classification. In R for Statistical Learning. Retrieved December 8, 2025, from https://daviddalpiaz.github.io/r4sl/classification.html

GeeksforGeeks. (2025, July 12). Classification in R Programming. Retrieved December 8, 2025, from https://www.geeksforgeeks.org/r-language/classification-in-r-programming/

karlyndiary. (n.d.). Coffee‑Shop‑Sales‑Analysis [Computer software]. GitHub. https://github.com/karlyndiary/Coffee-Shop-Sales-Analysis

Pamplona, D. D. (2023). Regression and Classification in R. RPubs. https://rpubs.com/dmpamplona/1105238

Penn Libraries. (2025, July 8). Text Analysis Using R. Retrieved December 8, 2025, from https://guides.library.upenn.edu/penntdm/r

Singh, D. (2019, November 18). Building classification models in R. Pluralsight. https://www.pluralsight.com/resources/blog/guides/building-classification-models-in-r

# Appendix (Optional)

```{r}
library(ggplot2)

coffee_sales %>%
  filter(product_category == "Drinking Chocolate") %>%
  ggplot(aes(x = transaction_qty, y = unit_price)) +
    geom_point(alpha = 0.6) +
    labs(
      x = "Transaction Quantity",
      y = "Unit Price (USD)",
      title = "Unit price vs. quantity for hot‑cocoa sales"
    ) +
    theme_minimal()

```

This scatterplot shows the relationship between transaction quantity and unit price for items in the Drinking Chocolate category—essentially, hot cocoa sales.  Each point represents a single transaction, plotting how many hot cocoas were bought at once (on the x-axis) and the price per unit during that transaction (on the y-axis).

What we see is that the unit price remains fairly consistent, regardless of how many items are purchased.  Whether a customer buys one, two, or three hot cocoas, the price per drink typically falls into the same small range (roughly $3.50–$4.75). There is no clear upward or downward trend, meaning higher quantities don’t lead to discounts or price increases—each unit is priced independently of the total purchased.

In short, the plot shows that hot cocoa pricing is stable, and customers are paying the same per cup whether they buy a single drink or multiple in the same transaction.
